{% extends "base.html" %}

{% block title %}Users - Team Management - Allo{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-8">
                    <a href="/dashboard" class="text-xl font-semibold text-gray-900">Allo</a>
                    <div class="flex space-x-4">
                        <a href="/team" class="text-gray-500 hover:text-gray-700">Team</a>
                        <a href="/team/users" class="text-indigo-600 font-medium">Users</a>
                        {% if current_user.has_manage_roles %}
                        <a href="/team/roles" class="text-gray-500 hover:text-gray-700">Roles</a>
                        {% endif %}
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    {% if current_user.has_team_write %}
                    <a href="/team/users/new" 
                       class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm hover:bg-indigo-700">
                        Add User
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Team Members</h3>
            </div>
            
            {% if users.len() == 0 %}
            <div class="p-6 text-center">
                <div class="text-gray-400 text-6xl mb-4">üë•</div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No users found</h3>
                <p class="text-gray-500 mb-4">Start by adding team members.</p>
                {% if current_user.has_team_write %}
                <a href="/team/users/new" 
                   class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
                    Add First User
                </a>
                {% endif %}
            </div>
            {% else %}
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                User
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Email
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Roles
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Last Login
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for user in users %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                               <div class="flex items-center">
                                   <div class="flex-shrink-0 h-10 w-10">
                                       <div class="h-10 w-10 rounded-full bg-indigo-500 flex items-center justify-center">
                                           <span class="text-sm font-medium text-white">
                                               {{ user.first_name.chars().nth(0).unwrap() }}{{ user.last_name.chars().nth(0).unwrap() }}
                                           </span>
                                       </div>
                                   </div>
                                   <div class="ml-4">
                                       <div class="text-sm font-medium text-gray-900">
                                           {{ user.first_name }} {{ user.last_name }}
                                           {% if user.id == current_user.id %}
                                           <span class="ml-1 inline-flex px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                               You
                                           </span>
                                           {% endif %}
                                       </div>
                                   </div>
                               </div>
                           </td>
                           <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                               {{ user.email }}
                           </td>
                           <td class="px-6 py-4 whitespace-nowrap">
                               <div class="flex flex-wrap gap-1">
                                   {% for role in user.roles %}
                                   <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                       {{ role.name }}
                                   </span>
                                   {% endfor %}
                                   {% if user.roles.len() == 0 %}
                                   <span class="text-gray-400 text-sm">No roles assigned</span>
                                   {% endif %}
                               </div>
                           </td>
                           <td class="px-6 py-4 whitespace-nowrap">
                               {% if user.is_locked %}
                               <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                                   üîí Locked
                               </span>
                               {% else if user.is_active %}
                               <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                   ‚úÖ Active
                               </span>
                               {% else %}
                               <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                   ‚è∏Ô∏è Inactive
                               </span>
                               {% endif %}
                           </td>
                           <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                               {% if user.last_login.is_some() %}
                               {{ user.last_login.unwrap().format("%b %d, %Y") }}
                               {% else %}
                               Never
                               {% endif %}
                           </td>
                           <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                               {% if current_user.has_team_write %}
                               <a href="/team/users/{{ user.id }}/edit" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                   Edit
                               </a>
                               {% endif %}
                               
                               {% if current_user.has_team_write && user.id != current_user.id %}
                                   {% if user.is_locked %}
                                   <a href="/team/users/{{ user.id }}/unlock" class="text-green-600 hover:text-green-900 mr-3">
                                       Unlock
                                   </a>
                                   {% else %}
                                   <a href="/team/users/{{ user.id }}/lock" class="text-yellow-600 hover:text-yellow-900 mr-3">
                                       Lock
                                   </a>
                                   {% endif %}
                               {% endif %}
                               
                               {% if current_user.has_team_delete && user.id != current_user.id %}
                               <a href="/team/users/{{ user.id }}/delete" 
                                  onclick="return confirm('Are you sure you want to delete this user? This action cannot be undone.')"
                                  class="text-red-600 hover:text-red-900">
                                   Delete
                               </a>
                               {% endif %}
                           </td>
                       </tr>
                       {% endfor %}
                   </tbody>
               </table>
           </div>
           {% endif %}
       </div>
   </div>
</div>
{% endblock %}